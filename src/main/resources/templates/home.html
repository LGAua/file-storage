<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Storage</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
<div class="container">
    <h1>File Storage</h1>

    <div th:replace="~{header}"></div>
    <div th:replace="~{search-field}"></div>

    <!-- Folder List Section -->
    <section class="section">

        <div th:if="${folderContentDto}" class="folder-content">
            <div class="breadcrumbs">
                <span th:each="breadCrumb : ${folderContentDto.breadCrumbs}">
                       <span> <a
                               th:href="'/?path=' + ${breadCrumb.value}"
                               th:text="${breadCrumb.key}" class="breadcrumb"></a> / </span>
                    </span>
            </div>

            <!--Create Folder-->
            <form method="post" th:action="@{/folder/new-folder}" th:object="${folderRequestDto}" class="form">
                <label for="folderName">Enter Folder Name:</label>
                <input type="text" id="folderName" name="folderName" th:field="*{folderName}" required class="input">
                <input name="folderPath" th:value="${folderContentDto.folderPath}" type="hidden">
                <input name="username" th:value="${#authentication.name}" type="hidden">
                <button type="submit" class="btn">Create Folder</button>
            </form>


            <!-- Folders -->
            <div class="folders" th:each="object : ${folderContentDto.objects}">

<!--                <div th:if="${object.isDir} == true" th:replace="~{folder-card}"></div>-->
<!--                <div th:if="${object.isDir} == false" th:replace="~{file-card}"></div>-->

                <div class="folder">
                    <form method="get" th:action="@{/}" class="form-inline">
                        <div th:text="${object.objectName}" class="folder-name"></div>
                        <a th:if="${object.isDir} == false"
                           th:href="${'/file/delete?fileName=' + object.objectName + '&filePath=' + object.objectPath + '&username=' + #authentication.name}">Delete</a>
                        <a th:if="${object.isDir} == true"
                           th:href="${'/folder/delete?folderName=' + object.objectName + '&folderPath=' + object.objectPath + '&username=' + #authentication.name}">Delete</a>
                        <input name="path" th:value="${object.objectPath}" type="hidden">
                        <button type="submit" class="btn-small">Get Files</button>
                    </form>
                    <form th:if="${object.isDir} == true" method="get" th:action="@{/folder/rename}"
                          class="form-inline">
                        <label for="folderNewName"></label>
                        <input type="text" id="folderNewName" name="folderNewName">
                        <input name="folderName" th:value="${object.objectName}" type="hidden">
                        <input name="folderPath" th:value="${object.objectPath}" type="hidden">
                        <input name="username" th:value="${#authentication.name}" type="hidden">
                        <button type="submit" class="btn-small">Rename</button>
                    </form>
                </div>
            </div>

            <!--            <div class="folders">-->
            <!--                <div th:each="folder : ${folderContentDto.folders}" class="folder">-->
            <!--                    <form method="get" th:action="@{/}" class="form-inline">-->
            <!--                        <div th:text="${folder.objectName}" class="folder-name"></div>-->
            <!--                        <a th:href="${'/folder/delete?folderName=' + folder.objectName + '&folderPath=' + folder.objectPath + '&username=' + #authentication.name}">Delete</a>-->
            <!--                        <input name="path" th:value="${folder.objectPath}" type="hidden">-->
            <!--                        <button type="submit" class="btn-small">Get Files</button>-->
            <!--                    </form>-->
            <!--                    <form method="get" th:action="@{/folder/rename}" class="form-inline">-->
            <!--                        <label for="folderNewName"></label>-->
            <!--                        <input type="text" id="folderNewName" name="folderNewName">-->
            <!--                        <input name="folderName" th:value="${folder.objectName}" type="hidden">-->
            <!--                        <input name="folderPath" th:value="${folder.objectPath}" type="hidden">-->
            <!--                        <input name="username" th:value="${#authentication.name}" type="hidden">-->
            <!--                        <button type="submit" class="btn-small">Rename</button>-->
            <!--                    </form>-->
            <!--                </div>-->
            <!--            </div>-->

            <!-- Files -->
            <!--            <div class="files">-->
            <!--                <div th:each="file : ${folderContentDto.files}" class="file">-->
            <!--                    <form method="get" th:action="@{/file}" th:object="${fileRequestDto}" class="form-inline">-->
            <!--                        <div th:text="${file.objectName}" class="file-name"></div>-->
            <!--                        <a th:href="${'/file/delete?fileName=' + file.objectName + '&filePath=' + file.objectPath + '&username=' + #authentication.name}">Delete</a>-->
            <!--                        <input name="fileName" th:value="${file.objectName}" type="hidden">-->
            <!--                        <input name="filePath" th:value="${file.objectPath}" type="hidden">-->
            <!--                        <input name="username" th:value="${#authentication.name}" type="hidden">-->
            <!--                        <button type="submit" class="btn-small">Download</button>-->
            <!--                    </form>-->
            <!--                </div>-->
            <!--            </div>-->

            <div th:if="${folderContentDto.objects.isEmpty()}">Folder is empty</div>
        </div>
    </section>
</div>

<!-- File Upload Section -->
<section class="section">
    <h2>File Upload</h2>
    <form method="post" th:action="@{/file}" th:object="${fileUploadDto}" enctype="multipart/form-data"
          class="form">
        <label for="object">Upload File:</label>
        <input type="file" id="object" name="file" th:field="*{file}" accept="multipart/form-data" required
               class="input">
        <input name="username" th:value="${#authentication.name}" type="hidden">
        <button type="submit" class="btn">Upload File</button>
    </form>
    <div th:if="${uploadFileSuccess}" class="success-message" th:text="${uploadFileSuccess}"></div>
</section>

<!-- Folder Upload Section -->
<section class="section">
    <h2>Folder Upload</h2>
    <form method="post" th:action="@{/folder}" th:object="${folderUploadDto}" enctype="multipart/form-data"
          class="form">
        <label for="folder">Upload Folder:</label>
        <input type="file" id="folder" name="folder" th:field="*{folder}" webkitdirectory
               accept="multipart/form-data" required class="input">
        <input name="username" th:value="${#authentication.name}" type="hidden">
        <button type="submit" class="btn">Upload Folder</button>
    </form>
    <div th:if="${uploadFolderSuccess}" class="success-message" th:text="${uploadFolderSuccess}"></div>
</section>
</body>

</html>
